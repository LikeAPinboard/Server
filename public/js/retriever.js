!function(e){function t(e){this.template=e,this.leftDelimiter="{{",this.rightDelimiter="}}",this.syntax=["obj"],this.counter=0,this.compiledTemplate=null,this.division=!0}t.leftDelimiter="{{",t.rightDelimiter="}}",t.setDelimiter=function(e,i){t.leftDelimiter=e||"{{",t.rightDelimiter=i||"}}"},t.Helpers={},t.make=function(e){return new t(e)},t.addHelper=function(e,i){t.Helpers[e]=i},t.addHelperObject=function(e){var i;for(i in e)e.hasOwnProperty(i)&&(t.Helpers[i]=e[i])},t.prototype._escape=function(e){return null===e||void 0===e?"":(e+"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},t.prototype.parse=function(e){return"function"!=typeof this.compiledTemplate&&this.compile(),this.compiledTemplate(e||{},t.Helpers,this._escape,"")},t.prototype.compile=function(){for(var e,i,r,n=new RegExp(t.leftDelimiter+"([/#@%])?(.+?)"+t.rightDelimiter,"g"),s=[],o=0,l=0;null!==(i=n.exec(this.template));)switch(e=this.template.slice(o,i.index),e&&!/^[\r\n\s]+$/.test(e)&&(s[s.length]=l>0?this.getPrefix()+this.quote(e.replace(/^[\n|\r]+|[\n|\r]+$/g,"")):this.getPrefix()+this.quote(e)),o=n.lastIndex,i[1]){case"#":s[s.length]=this.getPrefix()+this._compileHelper(i[2]);break;case"@":r=this._compileReservedVars(i[2]),r&&(s[s.length]=this.getPrefix()+r);break;case"%":s[s.length]=this.getPrefix()+this.syntax.join(".")+"."+i[2];break;case"/":"loop"===i[2]&&(this.syntax.pop(),this.counter--),s[s.length]="}",this.division=!0,l--;break;default:r=this._compileBuiltInControl(i[2]),r&&(s[s.length]=r),/^(loop|if)/.test(i[2])&&l++}return o<this.template.length&&(s[s.length]=this.getPrefix()+this.quote(this.template.slice(o))),s[s.length]=";return b;",this.compiledTemplate=new Function("obj","Helper","_e","b",s.join("")),this},t.prototype._compileHelper=function(e){var i,r=e.split(/\s+/),n=r.shift(),s=r.length,o=0;if("function"!=typeof t.Helpers[n])throw new Error('Parse Error: Helper "'+n+'" is undefined or not a function.');for(o=0;s>o;++o)i=this.getPrimitiveType(r[o]),null===i?r[o]=this.syntax.join(".")+"."+r[o]:"string"==typeof i?r[o]=this.quote(i):"number"==typeof i&&(r[o]=i);return"Helper."+n+"("+r.join(",")+")"},t.prototype._compileReservedVars=function(e){var t,i,r=!0;if("%"===e[0]&&(e=e.slice(1),r=!1),i=/^(data|index|parent)(.+)?/.exec(e),null!==i){switch(i[1]){case"data":t=this.syntax.join(".")+(i[2]||"");break;case"parent":t=this.syntax.slice(0,-1).join(".")+(i[2]||"");break;case"index":r=!1,t="i"+(this.counter-1);break;default:return}return r?"_e("+t+")":t}},t.prototype._compileBuiltInControl=function(e){var t,i,r=/^(if|else\sif|else|for|loop)(?:\s(.+))?/.exec(e);if(null===r)return this.getPrefix()+"_e("+this.syntax.join(".")+"."+e+")";switch(this.division=!0,r[1]){case"if":return";if("+this._parseCondition(r[2])+"){";case"else if":return"}else if("+this._parseCondition(r[2])+"){";case"else":return"}else{";case"loop":case"for":return i=this.counter,t=";for(var i"+i+"=0,size"+i+"=("+this.syntax.join(".")+"."+r[2]+"||[]).length; i"+i+"<size"+i+"; ++i"+i+"){",this.syntax[this.syntax.length]=r[2]+"[i"+this.counter++ +"]",t}},t.prototype.quote=function(e){return e=e.replace(/\\/g,"\\\\\\").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[']/g,"\\'"),"'"+e+"'"},t.prototype._parseCondition=function(e){for(var t,i,r=e.replace(/(!|>=?|<=?|={2,3}|[^\+]\+|[^\-]\-|\*|&{2}|\|{2})/g," $1 "),n=r.split(/\s+/),s=n.length,o=0,l=[];s>o;++o)t=n[o],/^(!|>=?|<=?|={1,3}|\+|\-|\*|&{2}|\|{2})$/.test(t)?l[l.length]=t:(i=this.getPrimitiveType(t),null===i?l[l.length]=this.syntax.join(".")+"."+t:"number"==typeof i?l[l.length]=i:"string"==typeof i&&(l[l.length]=this.quote(i)));return l.join(" ")},t.prototype.getPrimitiveType=function(e){var t;return null!==(t=/^['"](.+?)['"]$/.exec(e))?t[1]:null!==(t=/^([0-9\.]+)$/.exec(e))?-1!==t[1].indexOf(".")?parseFloat(t[1]):parseInt(t[1],10):null},t.prototype.getPrefix=function(){var e="+";return this.division===!0&&(e="b+=",this.division=!1),e},e.Retriever=t}(this);